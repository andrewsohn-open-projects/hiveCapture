<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>Document</title>

<style>
	
	.loading{display:none}

	.line{display:table;width:100%;}
	.line.success{color:green;}
	.line.error{color:gray;}
	.line strong{border:1px solid;display:table-cell;margin: 0 5px;}
	.line .num{width:10%;}
	.line .sp{width:1%;}
	.line .cnt{width:20%;}
</style>
<script src="../singapore.common.js"></script>
</head>
<body>

<button type="button" id="_timer_start">타이머 시작(0.8초 간격)</button>
<button type="button" id="_timer_stop">타이머 멈춤</button>
<button type="button" id="_search" disabled>검색</button>
<button type="button" id="_sort" disabled>정렬</button>

<img src="http://qa.hivelab.co.kr:4000/singaporeAL/assets/front/img/loading.gif" id="_loading" class="loading">

<h1>결과</h1>
<div id="_result_tags"></div>
<div id="_sort_result_tags"></div>

<script>
;(function($, window, document, undefined) {
    'use strict';

//https://www.instagram.com/developer/limits/

//https://api.instagram.com/oauth/authorize/?client_id=f6f600bd53c74a96805e21ba1ff0db0b&redirect_uri=http://www.yoursingapore.com&response_type=token

var tags = ['72-13Theatreworks','8QSAM-SingaporeArtMuseum','Aero-GreenTechnology','AlexandraHospital','ArmenianChurch','ArtRetreat','Artfolio','ArtScienceMuseumatMarinaBaySands','AryaseniArtGallery','AseanaGallery','AsiaAncientGallery','AsianCivilisationsMuseum','BabaHouse','BoatQuay','BollywoodVeggies','BooksActually','BuddhaToothRelicTempleandMuseum','BugisJunction','BugisStreet','BukitBatokNaturePark','BukitTimahNatureReserve','CentralSikhTemple','ChanHampe','ChangiBeach','ChangiMuseum','ChekJawa','ChengtaiNursery','Chinatown','ChinatownHeritageCentre','ChineseGarden','ChineseHeritageCentre','ChurchofTrueLight','CivilDefenceHeritageGallery','CivilianWarMemorial','ClarkeQuay','CollectorsContemporary','DalhousieObelisk','DramaBox','DreamFish-MerlionArowanasFarm','DynastiesAntique&ArtGallery','EastCoastPark','EmpressPlaceBuilding','Esplanade-TheatresontheBay','EsplanadeTheatresontheBay','EurasianHeritageCentre','Farmart','FireFliesHealthFarm','FortCanningPark','FortSiloso','FukTakChiMuseum','GajahGallery','GalerieBelvedere','GardensbytheBay','GillmanBarracks','HajiLane','HajjahFatimahMosque','HayDairies','HDBGallery','HollandVillage','HortPark','IndianNationalArmyMonument','JamaeMosque','JooChiat/Katong','JurongBirdPark','KampongGlam','KatongAntiqueHouse','KranjiCountryside','KranjiWarMemorial','KusuIsland','LabradorNatureReserve','LauPaSat','LavenderStreet','LianShanShuangLinTemple','LimBoSengMemorial','LittleIndiaArcade','LivingPortraitGallery','MacritchieNatureTrail','MaghainAbothSynagogue','MalayheritageCentre','MarinaBay','MarinaBayCruiseCentreSingapore','MarinaBaySandsSkyPark','MarineLifePark™','MasjidAbdulGafoor','MemoriesatFordfactory','MerlionPark','MINTMuseumofToys','Moca@Loewen','MountFaber','MustafaCentre','NgeeAnnCulturalCentre','NightSafari','NUSMuseum','NyeePhoeFlowerGarden','OdetoArtContemporary','OldHillStreetPoliceStation','OrchardRoad','Orchidville','Padang','Pasarbella-Afarmers’market','PeopleoftheRiver','PeranakanMuseum','PeranakanTrail','PulauHantu','PulauUbin','RafflesCityShoppingCentre','RedDotDesignMuseum','ReflectionsatBukitChandu','ResortsWorldSentosa','RiverSafariSingapore','Riverside','RobertsonQuay','SakyaMuniBuddhaGayaTemple','ScienceCentreSingapore','SculptureSquare','SentosaIsland','SilosoBeach','SingaporeBotanicGardens','SingaporeCityGallery','SingaporeCityHall','SingaporeCrocodilarium','SingaporeFlyer','SingaporeHongSanSee','SingaporePhilatelicMuseum','SingaporeRepertoryTheatre','SingaporeTylerPrintInstitute','SingaporeZoo','SistersIslands','SmithStreet','SriMariammanTemple','SriSenpagaVinayagarTemple','SriThandayuthapaniTemple','SriVeeramakaliammanTemple','StJohn’sIsland','St.AndrewsCathedral','St.JosephsChurch','Strangelets','SultanMosque','SunYatSengNanyangMemorialHall','SungeiBulohWetlandReserve','SuntecCityMall','TANGS','TanjongBeach','TekkaCentre','TheArtsHouse','TheCenotaph','TheHelixBridge','TheMerlionTower','TheNecessaryStage','TheSouthernRidges','TheSubstation','TheTheatrePractice','TheUndergroundCommandCentre','TheaterEkamatra','Theatreworks','ThekchenCholing','ThianHockKengTemple','TiongBahru','ToyFactoryProductions','UnderwaterWorldDolphinLagoon','UniversalStudiosSingapore','UtterlyArt','VictoriaTheatre','WildRice','YangGalleryPteLtd','YMCASingapore','CityGolf','ClubKyo','CrazyElephant','DXO','EastCoastPark','ExecutiveGolfCourse','FlyingTrapeze','ForestAdventure','GogreenCycle&IslandExplorer','GogreenSegwayEcoAdventure','GreenFairways','HomYoga','iFlySingapore','JurongGolfClub','KeppelClub','LagunaNationalGolf&Country','Lilliputt','ManaMana','MarinaBayGolfCourse','MegaZipAdventurePark','OrchidCountryClub','Phuture','RafflesCountryClub','RedDynasty','SeletarBaseGolfClub','SentosaGolfClub','SentosaLuge&Skyride','ShanghaiDolly','SingaporeCableCar','SingaporeIndoorStadium','SingaporeIslandCountryClub','SKI360°','SK-IIBoutiqueSpa','WingsofTime','TanahMerahCountryClub','ThePumpRoom','TigerSkyTower','UltimateDrive','VelvetUnderground','V-GolfSportsBar','WaveHouseSentosa','WildWildWet','XtremeSkatePark','Zirca','Zouk','Zouk','ZoukOut','1-Altitude','2AMDessertBar','328KatongLaksa','Absinthe','AcidBar','Annalakshmi','AuPetitSalut','BabaInn&Lounge','BalestierRoadHooverRojak','BarOpiume','BeerMarket','BlancoCourtPrawnMee','Brewerkz','Brotzeit®GermanBierBarRestaurant','BukitMerahViewCarrotCake','CanelePatisserieChocolaterie','Carousel','CasaBomVento','CÉLAVIrestaurant','ChefChans','Chijmes','Chilli-padi','ChinatownFoodStreet','ChompChomp','ChopTaiChongKok','Choupinette','CrystalJadeKitchen','CUT','DBBistroModerne','DinTaiFung','DOMVS','EastCoastLagoonFoodVillage','EastCoastSeafoodCentre','EquinoxRestaurant','FiveStarHainaneseChickenRiceFiveStarHainaneseChickenRice','FlyerLounge','FoodRepublic','Forlino','Garibaldi','Gattopardo','GeylangSeraiNewMarket','GoldenPeony','Hacienda','HaiTienLo','HajahMaimunahRestaurant','Halia','HuaTing','Ice-ColdBeer','Iggys','IlLido','ImperialTreasureCantoneseCuisine','Jaan','JaanRestaurant','Jamie’sItalian','Jazz@Southbridge','Jing','JoelRobuchonFineDining','JoelRobuchonRestaurant','JumboSeafood','KewGardenRestaurant','KimChooKitchen','Klee','KPO','LaMaisonduWhisky','Lantern','LauHongSerFamousRojak','LauPaSatFestivalMarket','LesAmis','LesSaveurs','LeVeL33','LiBai','LimCheeGuan','Loof','MajesticRestaurant','MakansutraGluttonsBay','MaxwellRoadHawkerCentre','Mezza9','MuddyMurphy’sIrishPub','MuthusCurryRestaurant','NewAsia','NewtonFoodCentre','NgAhSioPorkRibsSoupEatingHouse','NoSignboardSeafood','OneRochester','Orgo','Oscar’sCafe&Terrace','OSIABar&Restaurant','OsoRistorante','Overeasy','PaulanerBrauhausSingapore','PizzeriaandOsteriaMozza','PlumVillageRestaurant','Pontini','PostBar','PrincessTerraceCafe','Prive','PS.Cafe','PS.Cafe','QuentinsEurasianRestaurant','RangMahal','RestaurantAndre','RongChenBakKutThe','RumahMakanMinang','SabarMenantiRestaurant','SaintPierre','SaltGrill&SkyBar','SamysCurryRestaurant','SiChuanDouHua','SingaporeFoodTrail','Skyon57','SongFaBakKutThe','StraitsKitchen','TambuahMas','TanjongBeachClub','Tatsuya','TheCliff','TheLighthouse','TheLongBar','TheLounge','ThePrimeSociety','TheQueen&Mangosteen','TheRiceTable','TheSongofIndia','TheSpiffyDapper','TheWhiteRabbit','TianTianHainaneseChickenRice','TiongBahruBakery','TongHengConfectionary','TrueBlueCuisine','TungLokSignatures','TungLokHeen','TWG','UluUluSafariRestaurant','WakuGhin','WalaWalaCafeBar','WarungM.Nasir','WildHoney','YakunKayaToast','Yantra','YuanChunFamousLorMee','AmaraSanctuaryResortSentosa','AMOYHotelSingapore','CapellaSingaporeHotel','CarltonHotel','ConradCentennialSingapore','Crockfords™Tower','FestiveHotel','FragranceHotelImperial','GoodwoodParkHotel','GrandCopthorneWaterfrontHotel','GrandHyattSingapore','HardRockHotelSingapore','HolidayInnSingaporeAtrium','HotelGrandPacific','HotelJenTanglinSingapore','HotelMichael™','HotelRoyal@Queens','IbisSingaporeonBencoolenHotel','JenHotelOrchardgateway','MandarinOrientalSingapore','MarinaBaySandsSingapore','MarinaMandarinSingaporeHotel','NaumiHotel','NewMajesticHotel','OasiaHotelSingapore','PanPacificSingaporeHotel','ParcSovereignHotel-Tyrwhitt','ParkHotelClarkeQuay','ParkRegisSingapore','PARKROYALonPickering','PeninsulaExcelsiorHotel','QualityHotelSingapore','RafflesHotel','RamadaSingaporeatZhongshanPark','RegentSingapore','RendezvousGrandHotelSingapore','ResortsWorldSentosa-EquariusHotel','ResortsWorld™SentosaSignatureHotels','RoyalPlazaOnScottsHotel','Shangri-laRasaSentosaResort','SilosoBeachResortSentosa','SingaporeMarriottHotel','StudioMHotelSingapore','SwissotelMerchantCourt','SwissotelTheStamfordHotel','TheClubHotel','TheFullertonBayHotelSingapore','TheFullertonHotelSingapore','TheQuincyHotel','TheRitz-CarltonMilleniaSingapore','TheScarletSingapore','TheSingaporeResort&SpaSentosa','VHotelLavender','VillageHotelBugisbyFarEastHospitality','WSingaporeSentosaCove','WanderlustHotel','WangzHotel','313@somerset','BugisJunction','Centrepoint','ChangiAirport','CitySquareMall','DelfiOrchard','FarEastShoppingCentre','FunanDigitalMall','GoldenMileComplex','IONOrchard','JooChiatComplex','Knightsbridge','MandarinGallery','MarinaSquare','MilleniaWalk','MustafaCentre','NgeeAnnCity','OrchardCentral','PalaisRenaissance','Paragon','ParkMall','PlazaSingapura','RafflesCityShoppingCentre','ResortsWorld™SentosaFestiveWalk™','ScottsSquare','SuntecCity','TanglinShoppingCentre','TheShoppesatMarinaBaySands®','VivoCity','WismaAtria'];

var cloneTags = [];
var currentTags = [];

var resultTags = [];

var baseurl = 'https://api.instagram.com/v1/tags/';
var access_token = '?access_token='+ '2284411000.1fb234f.4d6ee4e48dff4f4588154a4fe2aa24db';

var proxy = null;
var ajaxOptions = {
	    type: 'POST',
	    method: 'POST',
	    timeout: 5000,
	    dataType: 'jsonp',
	};
var currentAjaxOptions = {};
var newUrl = {};
var page = 0;
var totalPage = tags.length / 10;

cloneTags = tags.slice(0, tags.length);

$('body').prepend('<div class="tags">' + tags + '</div>');
$('body').prepend('<div class="total"> 총 태그 갯수 :' + tags.length + '</div>');

var timer = null;

$(function(){
	$('#_timer_start').on('click', function(){
		$('#_loading').show();
		timer = setInterval(function(){
			if(page > totalPage){
				$('#_loading').hide();
				$('#_sort').trigger('click');
				clearTimeout(timer);
				return;
			}
			$('#_search').trigger('click');
		}, 8000);
	});

	$('#_timer_stop').on('click', function(){
		$('#_loading').hide();
		clearTimeout(timer);
	});

	$('#_search').on('click', function(){
		$('#_loading').hide();
		currentTags = cloneTags.splice(0, 10);

		console.log(page + '번째요청');
		console.log('Search Tags', currentTags);

		$.each(currentTags, function(index, value){
			var currentIndex = page + '' + (index + 1);
			if(10 == (index + 1)){
				currentIndex = (page + 1) * 10;
			}

			newUrl = { 'url' : baseurl + currentTags[index] + access_token };
			currentAjaxOptions = $.extend(true, ajaxOptions, newUrl);

			proxy = $.ajax(currentAjaxOptions);
			proxy.success(function(result){
				var tag = this.url.split('tags/')[1].split('?')[0];

				if (result.meta.code == 200) {
					console.log('Success: ', tag);

	                resultTags.push({ 
						'number': currentIndex,
						'tag': tag,
						'status': 'success',
						'count': result.data.media_count
					});
                }

                if (result.meta.code == 400) {
                    conosole.log('OAuthException');

	                resultTags.push({ 
						'number': currentIndex,
						'tag': tag,
						'status': 'error',
						'count': 0
					});
                }
			});

			proxy.error(function(parsedjson, textStatus, errorThrow){
				var tag = this.url.split('tags/')[1].split('?')[0];

                if(textStatus === 'timeout') {                    
                    console.log('404 Error: ', tag);
	                
	                resultTags.push({ 
						'number': currentIndex,
						'tag': tag,
						'status': 'error',
						'count': 0
					});  
                }             				
			});

			proxy.done(function(){
				$('#_loading').show();
			});
		});

		$('#_result_tags').empty();

		$.each(resultTags, function(index, value){
			$('#_result_tags').append('<div data-order="' + value.number + '" class="line ' + value.status + '">' + '<strong class="num">' + value.number + '</strong>' + '<strong class="sp">,</strong>' + '<strong class="tag">' + value.tag + '</strong>' + '<strong class="sp">,</strong>' + '<strong class="cnt">' + value.count + '</strong>'  + '</div>'); 
		});		

		page++;
	});

	$('#_sort').on('click', function(){
		var divs = $('#_result_tags div');
		var sortcount = 0;

		divs.sort(function (a, b) {
		    // convert to integers from strings
		    a = parseInt($(a).attr('data-order'), 10);
		    b = parseInt($(b).attr('data-order'), 10);
		    sortcount += 2;
		    // compare
		    if(a > b) {
		        return 1;
		    } else if(a < b) {
		        return -1;
		    } else {
		        return 0;
		    }
		});

		$('#_sort_result_tags').append(divs);

	});
});
})(jQuery, window, document);	
</script>
</body>
</html>